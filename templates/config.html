<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>StarBridge Configuration</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-black text-success">
    {{ nav|safe }}

    <div class="container mt-4">
        <h1 class="text-success">StarBridge Configuration</h1>
        <form method="POST" class="mt-4">

            <!-- SETTINGS -->
            <h2 class="text-success">Settings (settings.json)</h2>
            <div class="row mb-3">
                <label class="col-sm-3 col-form-label text-success">Git Executable</label>
                <div class="col-sm-9">
                    <input class="form-control bg-dark text-success border-success" name="git_executable" value="{{ settings.get('git_executable','') }}">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-3 col-form-label text-success">SSL Cert Path</label>
                <div class="col-sm-9">
                    <input class="form-control bg-dark text-success border-success" name="cert_path" value="{{ settings['ssl'].get('cert_path','') }}">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-3 col-form-label text-success">SSL Key Path</label>
                <div class="col-sm-9">
                    <input class="form-control bg-dark text-success border-success" name="key_path" value="{{ settings['ssl'].get('key_path','') }}">
                </div>
            </div>

            <!-- ENVIRONMENT -->
            <h2 class="text-success mt-4">Environment (.env - Non-Secrets)</h2>
            {% for key in env %}
            <div class="row mb-3">
                <label class="col-sm-3 col-form-label text-success">{{ key }}</label>
                <div class="col-sm-9">
                    {% if key in ['GIT_VERBOSE','PUSH_MODE', 'POLL_MODE', 'ENABLE_FRONTEND'] %}
                        <select class="form-select bg-dark text-success border-success" name="{{ key|lower }}">
                            <option value="true" {% if env[key]=='true' %}selected{% endif %}>true</option>
                            <option value="false" {% if env[key]=='false' %}selected{% endif %}>false</option>
                        </select>
                    {% else %}
                        <input class="form-control bg-dark text-success border-success" name="{{ key|lower }}" value="{{ env[key] }}">
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            <!-- SECRETS -->
            <h2 class="text-success mt-4">Secrets (Masked - Regenerate if Needed)</h2>
            {% for secret,label in [('STARBRIDGE_API_KEY','API Key'),('STARBRIDGE_SERVER_UUID','Server UUID')] %}
            <div class="row mb-3">
                <label class="col-sm-3 col-form-label text-success">{{ label }}</label>
                <div class="col-sm-6 pt-2 text-success">{{ masked_env[secret] }}</div>
                <div class="col-sm-3">
                    <button class="btn btn-success w-100" type="submit" name="regenerate_{{ secret|lower }}" value="1">
                        Regenerate
                    </button>
                </div>
            </div>
            {% endfor %}

            <button type="submit" class="btn btn-success btn-lg">Save Changes</button>
        </form>
    </div>
</body>
</html>